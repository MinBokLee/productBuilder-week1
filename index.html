<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lunch Picker & Animal Face Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <style>
        :root {
            --primary-color: #ff9f43;
            --accent-color: #ee5253;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-sub: #64748b;
            --stat-bg: #f1f5f9;
            --border-color: #e2e8f0;
        }

        [data-theme='dark'] {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            --stat-bg: #334155;
            --border-color: #334155;
        }

        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: var(--bg-color); 
            margin: 0; color: var(--text-main);
            transition: 0.3s; min-height: 100vh;
        }

        .page { display: none; width: 100%; flex-direction: column; align-items: center; padding: 20px; box-sizing: border-box; }
        .page.active { display: flex; animation: fadeIn 0.4s ease-out; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .container { 
            background: var(--card-bg); padding: 30px 20px; border-radius: 25px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; 
            width: 100%; max-width: 450px; position: relative;
        }

        .top-controls { position: absolute; top: 15px; right: 15px; display: flex; gap: 8px; }
        .control-btn { background: var(--stat-bg); border: none; border-radius: 10px; padding: 6px 10px; cursor: pointer; font-size: 0.8rem; font-weight: bold; color: var(--text-main); }

        .primary-btn { width: 100%; padding: 18px; font-size: 1.1rem; background-color: var(--accent-color); color: white; border: none; border-radius: 15px; cursor: pointer; font-weight: bold; }
        .secondary-btn { width: 100%; padding: 12px; background: var(--primary-color); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .link-btn { background: none; border: 1px solid var(--primary-color); color: var(--primary-color); padding: 12px; border-radius: 15px; cursor: pointer; font-weight: bold; width: 100%; margin-bottom: 20px; }

        .filter-group { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; }
        .filter-btn { padding: 8px 14px; border-radius: 20px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-sub); cursor: pointer; font-size: 0.8rem; }
        .filter-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        
        .menu-card { background: var(--card-bg); border: 2px solid var(--primary-color); border-radius: 20px; overflow: hidden; text-align: left; }
        .food-image { width: 100%; height: 200px; object-fit: cover; }

        #image-preview { width: 100%; max-width: 280px; border-radius: 20px; margin: 20px 0; display: none; }
        .result-box { margin-top: 20px; text-align: left; display: none; }
        .result-title { font-size: 1.6rem; font-weight: 900; color: var(--primary-color); text-align: center; margin-bottom: 15px; }
        .result-desc { background: var(--stat-bg); padding: 20px; border-radius: 15px; font-size: 0.95rem; line-height: 1.8; color: var(--text-main); }
        .result-section { margin-bottom: 10px; }
        .result-label { font-weight: bold; color: var(--accent-color); margin-right: 5px; }
        
        .bar-bg { background: var(--border-color); height: 8px; border-radius: 4px; overflow: hidden; margin-top: 5px; margin-bottom: 12px; }
        .bar-fill { background: var(--primary-color); height: 100%; width: 0; transition: 1s; }

        .bottom-section { width: 100%; max-width: 450px; margin-top: 20px; margin-bottom: 50px; }
        .form-toggle-btn { background: none; border: none; color: var(--text-sub); text-decoration: underline; cursor: pointer; width: 100%; margin-bottom: 15px; }
        #contact-form-wrapper { background: var(--card-bg); border-radius: 20px; padding: 20px; display: none; margin-bottom: 20px; border: 1px solid var(--border-color); }
        #disqus_thread { background: var(--card-bg); padding: 20px; border-radius: 20px; border: 1px solid var(--border-color); }
    </style>
</head>
<body data-theme="light">

    <div id="main-page" class="page active">
        <div class="container">
            <div class="top-controls">
                <button class="control-btn" onclick="toggleLang()">KO / EN</button>
                <button class="control-btn" onclick="toggleTheme()" id="theme-btn">ğŸŒ™</button>
            </div>
            <h1 id="main-title">ì˜¤ëŠ˜ ì ì‹¬ ë­ ë¨¹ì§€?</h1>
            <p id="main-sub" style="color:var(--text-sub); margin-bottom:25px;">ê²°ì • ì¥ì•  í•´ê²°ì‚¬! AI ë©”ë‰´ ì¶”ì²œ</p>

            <button class="link-btn" id="go-animal-btn" onclick="navigateTo('animal-page')">âœ¨ ë³´ë„ˆìŠ¤: ë™ë¬¼ìƒ í…ŒìŠ¤íŠ¸ í•˜ê¸°</button>

            <div class="filter-group">
                <button class="filter-btn active" data-filter="all" onclick="setFilter('all', this)" id="filter-all">ì „ì²´</button>
                <button class="filter-btn" data-filter="kr" onclick="setFilter('kr', this)" id="filter-kr">í•œì‹</button>
                <button class="filter-btn" data-filter="as" onclick="setFilter('as', this)" id="filter-as">ì¼/ì¤‘ì‹</button>
                <button class="filter-btn" data-filter="ws" onclick="setFilter('ws', this)" id="filter-ws">ì–‘ì‹</button>
            </div>

            <div id="menu-container"><p id="main-placeholder" style="margin:40px 0; color:var(--text-sub);">ë©”ë‰´ë¥¼ ì¶”ì²œí•´ ë“œë¦´ê¹Œìš”?</p></div>
            <button class="primary-btn" id="recommend-btn" onclick="generateLunchMenu()">ë©”ë‰´ ì¶”ì²œë°›ê¸°</button>
        </div>

        <div class="bottom-section">
            <button class="form-toggle-btn" id="contact-toggle" onclick="toggleContactForm()">ì œíœ´ ë° ë§›ì§‘ ë“±ë¡ ë¬¸ì˜</button>
            <div id="contact-form-wrapper">
                <form action="https://formspree.io/f/xojjjadw" method="POST">
                    <input type="text" name="name" id="form-name" placeholder="ì„±í•¨/ì—…ì²´ëª…" style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid var(--border-color);">
                    <textarea name="message" id="form-msg" placeholder="ë¬¸ì˜ ë‚´ìš©" rows="3" style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid var(--border-color);"></textarea>
                    <button type="submit" class="secondary-btn" id="form-submit">ë¬¸ì˜ ë³´ë‚´ê¸°</button>
                </form>
            </div>
            <div id="disqus_thread"></div>
        </div>
    </div>

    <div id="animal-page" class="page">
        <div class="container">
            <button id="back-btn" style="position:absolute; left:15px; top:15px; border:none; background:none; cursor:pointer; font-weight:bold; color:var(--text-sub);" onclick="navigateTo('main-page')">â† ëŒì•„ê°€ê¸°</button>
            <h1 id="animal-title" style="margin-top:20px;">AI ë™ë¬¼ìƒ í…ŒìŠ¤íŠ¸</h1>
            <p id="animal-sub" style="color:var(--text-sub);">AIê°€ ë¶„ì„í•˜ëŠ” ë‚˜ì˜ ì´ë¯¸ì§€</p>

            <div style="margin:30px 0;">
                <input type="file" id="image-upload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                <button class="primary-btn" id="upload-btn" style="background:var(--primary-color)" onclick="document.getElementById('image-upload').click()">ì‚¬ì§„ ì—…ë¡œë“œí•˜ê¸°</button>
            </div>

            <center><img id="image-preview" src="#"></center>

            <div id="result-area" class="result-box">
                <div id="result-title" class="result-title"></div>
                <div id="label-bars"></div>
                <div id="result-desc" class="result-desc"></div>
                <button class="secondary-btn" id="result-go-back" onclick="navigateTo('main-page')" style="background:var(--accent-color); margin-top:20px;">ì ì‹¬ ì¶”ì²œ ë°›ìœ¼ëŸ¬ ê°€ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        let currentLang = 'ko';
        let currentFilter = 'all';

        const i18n = {
            ko: {
                mainTitle: "ì˜¤ëŠ˜ ì ì‹¬ ë­ ë¨¹ì§€?",
                mainSub: "ê²°ì • ì¥ì•  í•´ê²°ì‚¬! AI ë©”ë‰´ ì¶”ì²œ",
                goAnimal: "âœ¨ ë³´ë„ˆìŠ¤: ë™ë¬¼ìƒ í…ŒìŠ¤íŠ¸ í•˜ê¸°",
                filterAll: "ì „ì²´", filterKr: "í•œì‹", filterAs: "ì¼/ì¤‘ì‹", filterWs: "ì–‘ì‹",
                placeholder: "ë©”ë‰´ë¥¼ ì¶”ì²œí•´ ë“œë¦´ê¹Œìš”?",
                recommendBtn: "ë©”ë‰´ ì¶”ì²œë°›ê¸°",
                contactToggle: "ì œíœ´ ë° ë§›ì§‘ ë“±ë¡ ë¬¸ì˜",
                formName: "ì„±í•¨/ì—…ì²´ëª…", formMsg: "ë¬¸ì˜ ë‚´ìš©", formSubmit: "ë¬¸ì˜ ë³´ë‚´ê¸°",
                back: "â† ëŒì•„ê°€ê¸°",
                animalTitle: "AI ë™ë¬¼ìƒ í…ŒìŠ¤íŠ¸",
                animalSub: "AIê°€ ë¶„ì„í•˜ëŠ” ë‚˜ì˜ ì´ë¯¸ì§€",
                uploadBtn: "ì‚¬ì§„ ì—…ë¡œë“œí•˜ê¸°",
                resultGoBack: "ì ì‹¬ ì¶”ì²œ ë°›ìœ¼ëŸ¬ ê°€ê¸°",
                analyzing: "ë¶„ì„ ì¤‘...",
                feature: "íŠ¹ì§•", personality: "ì„±ê²©", love: "ì—°ì•  ìŠ¤íƒ€ì¼",
                dogTitle: "ì¹œê·¼í•œ ê°•ì•„ì§€ìƒ",
                dogDesc: {
                    f: "ë¶€ë“œëŸ½ê³  ë‘¥ê¸€ë‘¥ê¸€í•œ ì¸ìƒìœ¼ë¡œ ë³´ëŠ” ì‚¬ëŒì„ ê¸°ë¶„ ì¢‹ê²Œ ë§Œë“œëŠ” ë§¤ë ¥ì´ ìˆìŠµë‹ˆë‹¤.",
                    p: "ë‹¤ì •ë‹¤ê°í•˜ê³  ì‚¬êµì ì´ë©°, ì–´ë””ì„œë‚˜ ì ì‘ë ¥ì´ ë›°ì–´ë‚œ 'ë¶„ìœ„ê¸° ë©”ì´ì»¤'ì…ë‹ˆë‹¤.",
                    l: "ìƒëŒ€ë°©ì—ê²Œ í—Œì‹ ì ì´ë©° ì• ì • í‘œí˜„ì´ ì†”ì§í•˜ê³  í’ë¶€í•œ ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤."
                },
                catTitle: "ë§¤ë ¥ì ì¸ ê³ ì–‘ì´ìƒ",
                catDesc: {
                    f: "ëˆˆë§¤ê°€ ë‚ ì¹´ë¡­ê³  ì„¸ë ¨ë˜ì–´ ë„ì‹œì ì´ê³  ë„ë„í•œ ë¶„ìœ„ê¸°ë¥¼ í’ê¹ë‹ˆë‹¤.",
                    p: "ìê¸°ì£¼ê´€ì´ ëšœë ·í•˜ê³  ê´€ì°°ë ¥ì´ ì¢‹ìœ¼ë©°, ê²‰ìœ¼ë¡œëŠ” ì°¨ê°€ì›Œ ë³´ì´ì§€ë§Œ ë‚´ë©´ì€ ë”°ëœ»í•œ 'ì¸¤ë°ë ˆ' ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤.",
                    l: "ë°€ë‹¹ì— ëŠ¥í•˜ë©° ìƒëŒ€ë°©ì˜ í˜¸ê¸°ì‹¬ì„ ìê·¹í•˜ëŠ” ë§¤í˜¹ì ì¸ ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤."
                }
            },
            en: {
                mainTitle: "What's for Lunch?",
                mainSub: "AI Menu Recommendation",
                goAnimal: "âœ¨ Bonus: Animal Face Test",
                filterAll: "All", filterKr: "Korean", filterAs: "Asian", filterWs: "Western",
                placeholder: "Shall I recommend a menu?",
                recommendBtn: "Get Recommendation",
                contactToggle: "Partnership Inquiry",
                formName: "Name / Company", formMsg: "Message", formSubmit: "Submit",
                back: "â† Back",
                animalTitle: "AI Face Test",
                animalSub: "Analyze your image with AI",
                uploadBtn: "Upload Photo",
                resultGoBack: "Go to Lunch Picker",
                analyzing: "Analyzing...",
                feature: "Feature", personality: "Personality", love: "Love Style",
                dogTitle: "Friendly Dog Face",
                dogDesc: {
                    f: "A soft and round impression that makes people feel comfortable and happy.",
                    p: "Affectionate, sociable, and an excellent 'mood maker' who adapts well anywhere.",
                    l: "Devoted to their partner and honest with a wealth of romantic expression."
                },
                catTitle: "Charming Cat Face",
                catDesc: {
                    f: "Sharp and sophisticated eyes that exude a chic and urban vibe.",
                    p: "Strong-willed and observant, with a 'Tsundere' style that is warm inside despite a cool exterior.",
                    l: "Good at the 'push and pull' of romance and attracting interest with mystery."
                }
            }
        };

        const menuData = [
            { category: 'kr', ko: "ì œìœ¡ë®ë°¥", en: "Spicy Pork Rice", kcal: 780, img: "https://images.unsplash.com/photo-1626074353765-517a681e40be?auto=format&fit=crop&w=800&q=80" },
            { category: 'as', ko: "ì—°ì–´ ì´ˆë°¥", en: "Salmon Sushi", kcal: 550, img: "https://images.unsplash.com/photo-1579871494447-9811cf80d66c?auto=format&fit=crop&w=800&q=80" },
            { category: 'ws', ko: "í•´ì‚°ë¬¼ íŒŒìŠ¤íƒ€", en: "Seafood Pasta", kcal: 620, img: "https://images.unsplash.com/photo-1551183053-bf91a1d81141?auto=format&fit=crop&w=800&q=80" }
        ];

        function toggleLang() {
            currentLang = currentLang === 'ko' ? 'en' : 'ko';
            updateTexts();
        }

        function updateTexts() {
            const t = i18n[currentLang];
            document.getElementById('main-title').innerText = t.mainTitle;
            document.getElementById('main-sub').innerText = t.mainSub;
            document.getElementById('go-animal-btn').innerText = t.goAnimal;
            document.getElementById('filter-all').innerText = t.filterAll;
            document.getElementById('filter-kr').innerText = t.filterKr;
            document.getElementById('filter-as').innerText = t.filterAs;
            document.getElementById('filter-ws').innerText = t.filterWs;
            document.getElementById('recommend-btn').innerText = t.recommendBtn;
            document.getElementById('contact-toggle').innerText = t.contactToggle;
            document.getElementById('form-name').placeholder = t.formName;
            document.getElementById('form-msg').placeholder = t.formMsg;
            document.getElementById('form-submit').innerText = t.formSubmit;
            document.getElementById('back-btn').innerText = t.back;
            document.getElementById('animal-title').innerText = t.animalTitle;
            document.getElementById('animal-sub').innerText = t.animalSub;
            document.getElementById('upload-btn').innerText = t.uploadBtn;
            document.getElementById('result-go-back').innerText = t.resultGoBack;
            if(document.getElementById('main-placeholder')) document.getElementById('main-placeholder').innerText = t.placeholder;
        }

        function navigateTo(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            if(pageId === 'animal-page') loadAnimalModel();
        }

        function setFilter(f, btn) {
            currentFilter = f;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function generateLunchMenu() {
            const container = document.getElementById('menu-container');
            const foods = menuData.filter(i => currentFilter === 'all' || i.category === currentFilter);
            const food = foods[Math.floor(Math.random() * foods.length)];
            container.innerHTML = `
                <div class="menu-card">
                    <img src="${food.img}" class="food-image">
                    <div style="padding:15px;">
                        <span style="background:var(--accent-color); color:white; padding:3px 8px; border-radius:5px; font-size:0.75rem;">${food.kcal} kcal</span>
                        <div style="font-weight:900; font-size:1.2rem; margin-top:5px;">${currentLang === 'ko' ? food.ko : food.en}</div>
                    </div>
                </div>`;
        }

        const ANIMAL_URL = "https://teachablemachine.withgoogle.com/models/ZGmPRyuJD/";
        let animalModel;

        async function loadAnimalModel() {
            if (!animalModel) {
                animalModel = await tmImage.load(ANIMAL_URL + "model.json", ANIMAL_URL + "metadata.json");
            }
        }

        async function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            document.getElementById('upload-btn').innerText = i18n[currentLang].analyzing;
            
            const reader = new FileReader();
            reader.onload = async (e) => {
                const img = document.getElementById('image-preview');
                img.src = e.target.result;
                img.style.display = 'inline-block';
                
                const prediction = await animalModel.predict(img);
                prediction.sort((a, b) => b.probability - a.probability);
                
                showAnimalResult(prediction);
                document.getElementById('upload-btn').innerText = i18n[currentLang].uploadBtn;
            };
            reader.readAsDataURL(file);
        }

        function showAnimalResult(prediction) {
            const top = prediction[0].className; 
            const t = i18n[currentLang];
            const resultArea = document.getElementById('result-area');
            const bars = document.getElementById('label-bars');
            const desc = document.getElementById('result-desc');
            
            resultArea.style.display = 'block';
            bars.innerHTML = "";

            let content = "";
            if(top === "ê°•ì•„ì§€ìƒ") {
                document.getElementById('result-title').innerText = t.dogTitle;
                content = `
                    <div class="result-section"><span class="result-label">[${t.feature}]</span> ${t.dogDesc.f}</div>
                    <div class="result-section"><span class="result-label">[${t.personality}]</span> ${t.dogDesc.p}</div>
                    <div class="result-section"><span class="result-label">[${t.love}]</span> ${t.dogDesc.l}</div>
                `;
            } else {
                document.getElementById('result-title').innerText = t.catTitle;
                content = `
                    <div class="result-section"><span class="result-label">[${t.feature}]</span> ${t.catDesc.f}</div>
                    <div class="result-section"><span class="result-label">[${t.personality}]</span> ${t.catDesc.p}</div>
                    <div class="result-section"><span class="result-label">[${t.love}]</span> ${t.catDesc.l}</div>
                `;
            }
            desc.innerHTML = content;

            prediction.forEach(p => {
                const prob = (p.probability * 100).toFixed(0);
                bars.innerHTML += `
                    <div style="margin-bottom:5px;">
                        <div style="display:flex; justify-content:space-between; font-size:0.75rem; font-weight:bold;">
                            <span>${p.className}</span><span>${prob}%</span>
                        </div>
                        <div class="bar-bg"><div class="bar-fill" style="width:${prob}%"></div></div>
                    </div>`;
            });
        }

        function toggleTheme() {
            const isLight = document.body.getAttribute('data-theme') === 'light';
            document.body.setAttribute('data-theme', isLight ? 'dark' : 'light');
            document.getElementById('theme-btn').innerText = isLight ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        function toggleContactForm() {
            const w = document.getElementById('contact-form-wrapper');
            w.style.display = w.style.display === 'block' ? 'none' : 'block';
        }

        updateTexts();

        (function() {
            var d = document, s = d.createElement('script');
            s.src = 'https://lunch-18.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
</body>
</html>