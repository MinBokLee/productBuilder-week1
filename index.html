<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ëŠ˜ ì ì‹¬ ë­ ë¨¹ì§€? & ë™ë¬¼ìƒ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <style>
        :root {
            --primary-color: #ff9f43;
            --accent-color: #ee5253;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-sub: #64748b;
            --stat-bg: #f1f5f9;
            --border-color: #e2e8f0;
        }

        [data-theme='dark'] {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            --stat-bg: #334155;
            --border-color: #334155;
        }

        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: var(--bg-color); 
            margin: 0; color: var(--text-main);
            transition: 0.3s; min-height: 100vh;
        }

        /* í˜ì´ì§€ ì „í™˜ìš© ì»¨í…Œì´ë„ˆ */
        .page { display: none; width: 100%; flex-direction: column; align-items: center; padding: 20px; box-sizing: border-box; }
        .page.active { display: flex; animation: fadeIn 0.4s ease-out; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .container { 
            background: var(--card-bg); padding: 30px 20px; border-radius: 25px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; 
            width: 100%; max-width: 450px; position: relative;
        }

        /* ê³µí†µ ë²„íŠ¼ */
        .primary-btn { width: 100%; padding: 18px; font-size: 1.1rem; background-color: var(--accent-color); color: white; border: none; border-radius: 15px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .primary-btn:hover { filter: brightness(1.1); }
        .secondary-btn { width: 100%; padding: 12px; background: var(--primary-color); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .link-btn { background: none; border: 1px solid var(--primary-color); color: var(--primary-color); padding: 12px; border-radius: 15px; cursor: pointer; font-weight: bold; width: 100%; margin-bottom: 20px; }

        /* ì ì‹¬ ì¶”ì²œ ì „ìš© */
        .filter-group { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; }
        .filter-btn { padding: 8px 14px; border-radius: 20px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-sub); cursor: pointer; font-size: 0.85rem; }
        .filter-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .menu-card { background: var(--card-bg); border: 2px solid var(--primary-color); border-radius: 20px; overflow: hidden; text-align: left; margin-bottom: 20px; }
        .food-image { width: 100%; height: 200px; object-fit: cover; }

        /* ë™ë¬¼ìƒ í…ŒìŠ¤íŠ¸ ì „ìš© */
        #image-preview { width: 100%; max-width: 280px; border-radius: 20px; margin: 20px 0; display: none; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .result-box { margin-top: 20px; text-align: left; display: none; }
        .result-title { font-size: 1.5rem; font-weight: 900; color: var(--primary-color); text-align: center; margin-bottom: 10px; }
        .result-desc { background: var(--stat-bg); padding: 15px; border-radius: 15px; font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px; }
        .label-bar-container { margin-bottom: 8px; }
        .label-text { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 4px; }
        .bar-bg { background: var(--border-color); height: 8px; border-radius: 4px; overflow: hidden; }
        .bar-fill { background: var(--primary-color); height: 100%; transition: 1s; }

        /* í•˜ë‹¨ ë° ëŒ“ê¸€ */
        .bottom-section { width: 100%; max-width: 450px; margin-top: 20px; }
        .form-toggle-btn { background: none; border: none; color: var(--text-sub); text-decoration: underline; cursor: pointer; width: 100%; margin-bottom: 15px; font-size: 0.85rem; }
        #contact-form-wrapper { background: var(--card-bg); border-radius: 20px; padding: 20px; display: none; margin-bottom: 20px; border: 1px solid var(--border-color); }
        #disqus_thread { background: var(--card-bg); padding: 20px; border-radius: 20px; border: 1px solid var(--border-color); }
    </style>
</head>
<body data-theme="light">

    <div id="main-page" class="page active">
        <div class="container">
            <button class="control-btn" style="position:absolute; right:15px; top:15px; border:none; background:none; font-size:1.2rem; cursor:pointer;" onclick="toggleTheme()">ğŸŒ™</button>
            <h1>ì˜¤ëŠ˜ ì ì‹¬ ë­ ë¨¹ì§€?</h1>
            <p style="color:var(--text-sub); margin-bottom:25px;">ê²°ì • ì¥ì•  í•´ê²°ì‚¬! AI ë©”ë‰´ ì¶”ì²œ</p>

            <button class="link-btn" onclick="navigateTo('animal-page')">âœ¨ ë³´ë„ˆìŠ¤: ì‚¬ì§„ìœ¼ë¡œ ë™ë¬¼ìƒ í…ŒìŠ¤íŠ¸ í•˜ê¸°</button>

            <div class="filter-group">
                <button class="filter-btn active" onclick="setFilter('all', this)">ì „ì²´</button>
                <button class="filter-btn" onclick="setFilter('kr', this)">í•œì‹</button>
                <button class="filter-btn" onclick="setFilter('as', this)">ì¼/ì¤‘ì‹</button>
                <button class="filter-btn" onclick="setFilter('ws', this)">ì–‘ì‹</button>
            </div>

            <div id="menu-container"><p style="margin:40px 0; color:var(--text-sub);">ì–´ë–¤ ìŒì‹ì„ ë¨¹ê²Œ ë ê¹Œìš”?</p></div>
            <button class="primary-btn" onclick="generateLunchMenu()">ë©”ë‰´ ì¶”ì²œë°›ê¸°</button>
        </div>

        <div class="bottom-section">
            <button class="form-toggle-btn" onclick="toggleContactForm()">ì œíœ´ ë° ë§›ì§‘ ë“±ë¡ ë¬¸ì˜</button>
            <div id="contact-form-wrapper">
                <form action="https://formspree.io/f/xojjjadw" method="POST">
                    <input type="text" name="name" placeholder="ì„±í•¨/ì—…ì²´ëª…" style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid var(--border-color);">
                    <textarea name="message" placeholder="ë¬¸ì˜ ë‚´ìš©" rows="3" style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid var(--border-color);"></textarea>
                    <button type="submit" class="secondary-btn">ë¬¸ì˜ ë³´ë‚´ê¸°</button>
                </form>
            </div>
            <div id="disqus_thread"></div>
        </div>
    </div>

    <div id="animal-page" class="page">
        <div class="container">
            <button style="position:absolute; left:15px; top:15px; border:none; background:none; cursor:pointer; font-weight:bold; color:var(--text-sub);" onclick="navigateTo('main-page')">â† ëŒì•„ê°€ê¸°</button>
            <h1 style="margin-top:20px;">AI ë™ë¬¼ìƒ í…ŒìŠ¤íŠ¸</h1>
            <p style="color:var(--text-sub);">ë‹¹ì‹ ì€ ê°•ì•„ì§€ìƒì¼ê¹Œìš”, ê³ ì–‘ì´ìƒì¼ê¹Œìš”?</p>

            <div id="upload-area" style="margin:30px 0;">
                <input type="file" id="image-upload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                <button class="primary-btn" style="background:var(--primary-color)" onclick="document.getElementById('image-upload').click()">ì‚¬ì§„ ì—…ë¡œë“œí•˜ê¸°</button>
                <p style="font-size:0.75rem; color:var(--text-sub); margin-top:10px;">* ì‚¬ì§„ì€ ë¶„ì„ í›„ì— ì–´ë””ì—ë„ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
            </div>

            <center><img id="image-preview" src="#"></center>

            <div id="result-area" class="result-box">
                <div id="result-title" class="result-title">ë¶„ì„ ê²°ê³¼</div>
                <div id="result-desc" class="result-desc"></div>
                <div id="label-bars"></div>
                <button class="secondary-btn" onclick="navigateTo('main-page')" style="background:var(--accent-color)">ë‚˜ì—ê²Œ ì–´ìš¸ë¦¬ëŠ” ë©”ë‰´ ë¨¹ìœ¼ëŸ¬ ê°€ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        // í˜ì´ì§€ ì „í™˜ ë¡œì§
        function navigateTo(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0,0);
            if(pageId === 'animal-page') loadAnimalModel();
        }

        // --- ì ì‹¬ ì¶”ì²œ ë¡œì§ ---
        let currentFilter = 'all';
        const menuData = [
            { category: 'kr', name: "ì œìœ¡ë®ë°¥", kcal: 780, img: "https://images.unsplash.com/photo-1626074353765-517a681e40be?auto=format&fit=crop&w=800&q=80" },
            { category: 'as', name: "ì—°ì–´ ì´ˆë°¥", kcal: 550, img: "https://images.unsplash.com/photo-1579871494447-9811cf80d66c?auto=format&fit=crop&w=800&q=80" },
            { category: 'ws', name: "í•´ì‚°ë¬¼ íŒŒìŠ¤íƒ€", kcal: 620, img: "https://images.unsplash.com/photo-1551183053-bf91a1d81141?auto=format&fit=crop&w=800&q=80" },
            { category: 'kr', name: "ë¹„ë¹”ë°¥", kcal: 560, img: "https://images.unsplash.com/photo-1590301157890-4810ed352733?auto=format&fit=crop&w=800&q=80" }
        ];

        function setFilter(f, btn) {
            currentFilter = f;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function generateLunchMenu() {
            const container = document.getElementById('menu-container');
            const foods = menuData.filter(i => currentFilter === 'all' || i.category === currentFilter);
            const food = foods[Math.floor(Math.random() * foods.length)];
            container.innerHTML = `
                <div class="menu-card">
                    <img src="${food.img}" class="food-image">
                    <div style="padding:15px;">
                        <span style="background:var(--accent-color); color:white; padding:3px 8px; border-radius:5px; font-size:0.75rem;">${food.kcal} kcal</span>
                        <div style="font-weight:900; font-size:1.2rem; margin-top:5px;">${food.name}</div>
                    </div>
                </div>`;
        }

        // --- ë™ë¬¼ìƒ í…ŒìŠ¤íŠ¸ ë¡œì§ (Teachable Machine) ---
        const ANIMAL_URL = "https://teachablemachine.withgoogle.com/models/ZGmPRyuJD/";
        let animalModel;

        async function loadAnimalModel() {
            if (!animalModel) {
                animalModel = await tmImage.load(ANIMAL_URL + "model.json", ANIMAL_URL + "metadata.json");
            }
        }

        const animalDetails = {
            "ê°•ì•„ì§€ìƒ": {
                desc: "ë‹¹ì‹ ì€ ë‹¤ì •ë‹¤ê°í•˜ê³  í™œê¸°ì°¬ ì—ë„ˆì§€ë¥¼ ê°€ì§„ 'ê°•ì•„ì§€ìƒ'ì´êµ°ìš”! ì¹œê·¼í•œ ì¸ìƒìœ¼ë¡œ ì£¼ë³€ ì‚¬ëŒë“¤ì—ê²Œ ì¸ê¸°ê°€ ë§ìœ¼ë©°, ë°ì€ ë¯¸ì†Œê°€ ë§¤ë ¥ì ì…ë‹ˆë‹¤.",
                food: "í•¨ê»˜ ì¦ê¸¸ ìˆ˜ ìˆëŠ” 'ì œìœ¡ë®ë°¥'ì´ë‚˜ 'ì‚¼ê²¹ì‚´'ì€ ì–´ë– ì‹ ê°€ìš”?"
            },
            "ê³ ì–‘ì´ìƒ": {
                desc: "ë‹¹ì‹ ì€ ì„¸ë ¨ë˜ê³  ë„ë„í•œ ë§¤ë ¥ì„ ê°€ì§„ 'ê³ ì–‘ì´ìƒ'ì…ë‹ˆë‹¤! ì²«ì¸ìƒì€ ì°¨ê°€ì›Œ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ, ì•Œë©´ ì•Œìˆ˜ë¡ ê¹Šì€ ë§¤ë ¥ì„ ê°€ì§„ ì¸¤ë°ë ˆ ìŠ¤íƒ€ì¼ì´ ë§ìŠµë‹ˆë‹¤.",
                food: "ê¹”ë”í•˜ê³  ì •ê°ˆí•œ 'ì—°ì–´ ì´ˆë°¥'ì´ë‚˜ 'íŒŒìŠ¤íƒ€'ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤!"
            }
        };

        async function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = async (e) => {
                const img = document.getElementById('image-preview');
                img.src = e.target.result;
                img.style.display = 'inline-block';
                
                const prediction = await animalModel.predict(img);
                prediction.sort((a, b) => b.probability - a.probability);

                const topResult = prediction[0].className;
                document.getElementById('result-area').style.display = 'block';
                document.getElementById('result-title').innerText = `ë‹¹ì‹ ì€ ê·€ì—¬ìš´ ${topResult}!`;
                document.getElementById('result-desc').innerHTML = `<b>${animalDetails[topResult]?.desc || ""}</b><br><br>ğŸ± ì¶”ì²œ ë©”ë‰´: ${animalDetails[topResult]?.food || ""}`;

                const barContainer = document.getElementById('label-bars');
                barContainer.innerHTML = "";
                prediction.forEach(p => {
                    const prob = (p.probability * 100).toFixed(0);
                    barContainer.innerHTML += `
                        <div class="label-bar-container">
                            <div class="label-text"><span>${p.className}</span><span>${prob}%</span></div>
                            <div class="bar-bg"><div class="bar-fill" style="width:${prob}%"></div></div>
                        </div>`;
                });
            };
            reader.readAsDataURL(file);
        }

        function toggleTheme() {
            const isLight = document.body.getAttribute('data-theme') === 'light';
            document.body.setAttribute('data-theme', isLight ? 'dark' : 'light');
        }

        function toggleContactForm() {
            const w = document.getElementById('contact-form-wrapper');
            w.style.display = w.style.display === 'block' ? 'none' : 'block';
        }

        // Disqus
        (function() {
            var d = document, s = d.createElement('script');
            s.src = 'https://lunch-18.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
</body>
</html>